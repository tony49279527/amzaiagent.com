<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Discovery - AI Market Analysis | Amz AI Agent</title>
    <meta name="description"
        content="Discover profitable product opportunities with AI-powered market analysis. No need to reveal your own product.">

    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="canonical" href="https://amzaiagent.com/discovery.html">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%232563eb%22/><path d=%22M50 20 L20 80 H35 L42 65 H58 L65 80 H80 L50 20 Z M45 58 L50 45 L55 58 H45 Z%22 fill=%22white%22/></svg>">
</head>

<body class="dark-theme create-page">
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="2" width="20" height="20" rx="6" fill="#2563eb" />
                    <path d="M7 12H17M7 8H17M7 16H13" stroke="white" stroke-width="2" stroke-linecap="round" />
                </svg>
                <span class="logo-text">Amz AI Agent</span>
            </a>

            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn" aria-label="Toggle Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="menu-icon-open">
                    <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="menu-icon-close"
                    style="display:none;">
                    <path d="M6 18L18 6M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>

            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="create.html">Competitor Analysis</a>
                <a href="discovery.html" class="active">Product Discovery</a>
                <a href="cases.html">Cases</a>
                <a href="blog.html">Blog</a>
                <a href="pricing.html">Pricing</a>
            </div>
            <div class="nav-actions">
                <a href="create.html" class="btn btn-primary" style="border-radius: 0.375rem;">Start Analysis</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="analysis-header">
                <h1>üîç Product Discovery</h1>
                <h2>Find Your Next Winning Product</h2>
                <p>Analyze market opportunities without revealing your own product. Perfect for product research and
                    selection.</p>
            </div>

            <div class="form-card">
                <form id="discovery-form">
                    <!-- Basic Configuration -->
                    <div class="form-grid">
                        <!-- 3-Level Category Selection -->
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Product Category *</label>
                            <p class="helper-text">Select the category hierarchy for your product research</p>
                            <div
                                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 0.5rem;">
                                <select id="category-level-1" required>
                                    <option value="">-- Select Main Category --</option>
                                </select>
                                <select id="category-level-2" disabled>
                                    <option value="">-- Select Sub-Category --</option>
                                </select>
                                <select id="category-level-3" disabled>
                                    <option value="">-- Select Product Type --</option>
                                </select>
                            </div>
                        </div>

                        <!-- Product Keywords (PRIMARY) -->
                        <div class="form-group">
                            <label for="product-keywords">Product Keywords *</label>
                            <p class="helper-text">Enter search terms customers use to find this product</p>
                            <input type="text" id="product-keywords" name="product-keywords"
                                placeholder="e.g., non-slip yoga mat, thick exercise mat, eco-friendly..." required>
                        </div>

                        <!-- Marketplace -->
                        <div class="form-group">
                            <label for="marketplace">Marketplace *</label>
                            <p class="helper-text">Select the Amazon marketplace for your analysis</p>
                            <select id="marketplace" name="marketplace">
                                <option value="US" selected>üá∫üá∏ United States</option>
                                <option value="CA">üá®üá¶ Canada</option>
                                <option value="GB">üá¨üáß United Kingdom</option>
                                <option value="DE">üá©üá™ Germany</option>
                                <option value="FR">üá´üá∑ France</option>
                                <option value="IT">üáÆüáπ Italy</option>
                                <option value="ES">üá™üá∏ Spain</option>
                                <option value="JP">üáØüáµ Japan</option>
                            </select>
                        </div>

                        <!-- Analysis Focus - Styled Cards -->
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Analysis Focus</label>
                            <p class="helper-text" id="focus-helper">Free users get Market Entry assessment.
                                <a href="#" id="upgrade-focus-link"
                                    style="color: var(--primary-color); font-weight: 600;">Upgrade to Pro</a> to select
                                multiple focus areas.
                            </p>
                            <div class="analysis-focus-cards"
                                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 0.75rem;">
                                <!-- Market Entry - Default for Free -->
                                <div class="focus-card active" id="focus-market-entry" data-value="market-entry"
                                    style="padding: 1rem; border: 2px solid var(--primary-color); border-radius: 0.75rem; background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(37, 99, 235, 0.05)); cursor: pointer; transition: all 0.2s;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üéØ</div>
                                    <h4 style="margin: 0 0 0.25rem 0; font-size: 0.95rem;">Market Entry</h4>
                                    <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary);">Should I
                                        enter this market?</p>
                                    <span class="focus-badge"
                                        style="display: inline-block; margin-top: 0.5rem; font-size: 0.7rem; background: var(--primary-color); color: white; padding: 0.125rem 0.5rem; border-radius: 9999px;">Default</span>
                                </div>
                                <!-- Differentiation - Locked for Free -->
                                <div class="focus-card locked" id="focus-differentiation" data-value="differentiation"
                                    style="padding: 1rem; border: 2px solid var(--border-color); border-radius: 0.75rem; background: var(--bg-secondary); opacity: 0.7; cursor: not-allowed; transition: all 0.2s; position: relative;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üí°</div>
                                    <h4 style="margin: 0 0 0.25rem 0; font-size: 0.95rem;">Differentiation</h4>
                                    <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary);">How can I
                                        stand out?</p>
                                    <span class="lock-badge"
                                        style="position: absolute; top: 0.5rem; right: 0.5rem;">üîí</span>
                                </div>
                                <!-- Pricing - Locked for Free -->
                                <div class="focus-card locked" id="focus-pricing" data-value="pricing"
                                    style="padding: 1rem; border: 2px solid var(--border-color); border-radius: 0.75rem; background: var(--bg-secondary); opacity: 0.7; cursor: not-allowed; transition: all 0.2s; position: relative;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üí∞</div>
                                    <h4 style="margin: 0 0 0.25rem 0; font-size: 0.95rem;">Pricing Strategy</h4>
                                    <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary);">What price
                                        point works?</p>
                                    <span class="lock-badge"
                                        style="position: absolute; top: 0.5rem; right: 0.5rem;">üîí</span>
                                </div>
                            </div>
                        </div>

                        <!-- Reference ASINs (OPTIONAL) - Moved UP -->
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="product-asins">Reference ASINs <span
                                    style="color: var(--text-secondary); font-weight: normal;">(Optional)</span></label>
                            <p class="helper-text">If you know specific products to analyze, enter their ASINs.
                                Otherwise, we'll find top products automatically.</p>
                            <textarea id="product-asins" name="product-asins"
                                placeholder="B08XXXXXX1&#10;B08XXXXXX2&#10;(Leave empty to auto-discover)"
                                style="min-height: 80px;"></textarea>
                        </div>

                        <!-- Analysis Prompt (Moved to BOTTOM) -->
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <label>Analysis Prompt
                                    <span id="prompt-mode-badge"
                                        style="font-size: 0.7rem; background: #e5e7eb; color: #6b7280; padding: 0.125rem 0.5rem; border-radius: 9999px; margin-left: 0.5rem;">Free:
                                        Read-only</span>
                                </label>
                            </div>
                            <p class="helper-text" id="prompt-helper">This is the analysis framework that guides the AI
                                report generation.</p>
                            <textarea id="default-prompt" readonly
                                style="min-height: 200px; max-height: 400px; overflow-y: auto; background: var(--bg-secondary); opacity: 0.85; cursor: not-allowed; font-family: 'Inter', monospace; font-size: 0.9rem; line-height: 1.6; padding: 1rem;">Analyze the market opportunity in the selected category:

1. MARKET OVERVIEW
   - Price range distribution (budget/mid/premium)
   - Review volume and rating patterns
   - Competitive landscape and market concentration

2. CUSTOMER PAIN POINTS
   - Top 5 recurring complaints from negative reviews
   - Unmet needs and feature requests
   - Quality and durability issues

3. OPPORTUNITY ANALYSIS
   - Market gaps and underserved segments
   - Differentiation opportunities
   - Target customer profile

4. ENTRY STRATEGY RECOMMENDATIONS
   - Suggested price positioning
   - Key features to prioritize
   - Potential risks and mitigation</textarea>
                        </div>
                    </div>

                    <!-- Advanced Configuration (Locked for Free Users) -->
                    <div class="advanced-section-wrapper">
                        <details class="advanced-config">
                            <summary
                                style="cursor: pointer; padding: 1rem 0; color: var(--primary-color); font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                                <span>Advanced Options (Pro)</span>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M6 9l6 6 6-6" />
                                </svg>
                                <span class="badge-pro-gradient">PRO</span>
                            </summary>

                            <div class="config-section pro-locked"
                                style="margin-top: 1rem; opacity: 1; position: relative;">
                                <!-- Unlock Overlay -->
                                <div id="pro-unlock-overlay" class="pro-overlay">
                                    <button type="button" class="btn-primary"
                                        style="padding: 0.75rem 1.5rem; border-radius: 9999px; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
                                        <span>üíé</span> Unlock Premium Features
                                    </button>
                                </div>
                                <h3 class="config-title">Analysis Configuration</h3>
                                <div class="config-grid">
                                    <!-- Row 1: Report Language & LLM Model -->
                                    <div class="form-group">
                                        <label>Report Language <span class="lock-icon">üîí</span></label>
                                        <select disabled class="pro-feature">
                                            <option value="English" selected>English (Default)</option>
                                            <option value="Fran√ßais">Fran√ßais</option>
                                            <option value="Deutsch">Deutsch</option>
                                            <option value="Italiano">Italiano</option>
                                            <option value="Espa√±ol">Espa√±ol</option>
                                            <option value="Êó•Êú¨Ë™û">Êó•Êú¨Ë™û</option>
                                            <option value="‰∏≠Êñá">‰∏≠Êñá</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label>LLM Model <span class="lock-icon">üîí</span></label>
                                        <select disabled class="pro-feature" id="llm-model">
                                            <option value="anthropic/claude-sonnet-4.5" selected>
                                                anthropic/claude-sonnet-4.5</option>
                                            <option value="google/gemini-3-pro-preview">google/gemini-3-pro-preview
                                            </option>
                                            <option value="openai/gpt-5.2-pro">openai/gpt-5.2-pro</option>
                                        </select>
                                    </div>

                                    <!-- Row 2: Website & YouTube Counts -->
                                    <div class="form-group">
                                        <label>Reference Website Count <span class="lock-icon">üîí</span></label>
                                        <select disabled class="pro-feature">
                                            <option value="10" selected>10 Websites (Default)</option>
                                            <option value="20">20 Websites</option>
                                            <option value="30">30 Websites</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label>Reference YouTube Count <span class="lock-icon">üîí</span></label>
                                        <select disabled class="pro-feature">
                                            <option value="10" selected>10 Videos (Default)</option>
                                            <option value="20">20 Videos</option>
                                            <option value="30">30 Videos</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>

                    <button type="submit" id="submitBtn" class="submit-btn">
                        üöÄ Start Product Discovery
                    </button>
                </form>
            </div>

            <!-- What You'll Get Section -->
            <div class="features-preview" style="margin-top: 3rem; text-align: center;">
                <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">What You'll Discover</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                    <div class="feature-card"
                        style="padding: 1.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
                        <h4>Market Overview</h4>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">Price ranges, review patterns, and
                            competitive landscape</p>
                    </div>
                    <div class="feature-card"
                        style="padding: 1.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üò§</div>
                        <h4>Pain Points</h4>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">Common customer complaints across
                            products</p>
                    </div>
                    <div class="feature-card"
                        style="padding: 1.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üí°</div>
                        <h4>Opportunities</h4>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">Market gaps and differentiation
                            ideas</p>
                    </div>
                    <div class="feature-card"
                        style="padding: 1.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéØ</div>
                        <h4>Entry Strategy</h4>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">Recommended features and positioning
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Email/Info Modal (Free Tier) -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <button type="button" class="modal-close" id="modal-close">&times;</button>
            <h2>Get Your Product Discovery Report</h2>
            <p class="modal-desc">Please complete the info below. Your free report will be sent to your email.</p>
            <form id="modal-form">
                <div class="form-group">
                    <label for="user-name">Name *</label>
                    <input type="text" id="user-name" name="user-name" placeholder="Enter your name" required>
                </div>
                <div class="form-group">
                    <label for="user-email">Email *</label>
                    <input type="email" id="user-email" name="user-email" placeholder="name@example.com" required>
                </div>
                <div class="form-group">
                    <label for="user-industry">Target Category *</label>
                    <input type="text" id="user-industry" name="user-industry"
                        placeholder="e.g. Home & Garden, Sports..." required>
                </div>
                <!-- Upsell Link -->
                <div style="margin-bottom: 1rem; text-align: center;">
                    <p style="font-size: 0.85rem; color: var(--text-secondary);">
                        Want deeper insights, custom prompts & file uploads?<br>
                        <a href="#" id="switch-to-pro-link"
                            style="color: var(--primary-color); font-weight: 600;">Upgrade to Pro Analysis</a>
                    </p>
                </div>
                <button type="submit" class="submit-btn" id="confirm-submission-btn" style="width: 100%;">Confirm &
                    Start Free Discovery</button>
            </form>
        </div>
    </div>

    <!-- Payment Deposit Modal (Pro Tier) -->
    <div id="payment-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <button type="button" class="modal-close" id="payment-modal-close">&times;</button>
            <div style="text-align: center; margin-bottom: 2rem;">
                <div
                    style="background: #eef2ff; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <span style="font-size: 2rem;">üíé</span>
                </div>
                <h2>Unlock Premium Discovery</h2>
                <p style="color: var(--text-secondary); margin-bottom: 0.5rem; font-size: 0.95rem;">
                    Get <strong>deeper market insights, custom analysis, and expert recommendations</strong>.
                </p>
            </div>

            <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Total Service Fee</span>
                    <span style="font-weight: 600;">$29.99</span>
                </div>
                <div
                    style="display: flex; justify-content: space-between; color: var(--primary-color); font-weight: 600; font-size: 1.25rem;">
                    <span>Deposit Due Now</span>
                    <span>$4.99</span>
                </div>
                <div style="margin-top: 1rem; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 1rem;">
                    <p style="font-size: 0.9rem; color: #333; margin-bottom: 0.25rem;"><strong>Payment Terms:</strong>
                    </p>
                    <ul
                        style="font-size: 0.85rem; color: var(--text-secondary); text-align: left; padding-left: 1.5rem; margin: 0;">
                        <li>Pay <strong>$4.99</strong> now to start the comprehensive analysis.</li>
                        <li>Pay the remaining <strong>$25.00</strong> only after you preview the report.</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: 1rem; margin-bottom: 1.5rem;">
                <label for="pro-email-input"
                    style="display: block; text-align: left; font-size: 0.9rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                    Where should we send the report?
                </label>
                <input type="email" id="pro-email-input" placeholder="name@example.com"
                    style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 1rem;">
            </div>

            <button id="pay-deposit-btn" class="submit-btn"
                style="background: linear-gradient(135deg, #4f46e5 0%, #2563eb 100%); width: 100%;">
                Pay $4.99 with Stripe (Sandbox)
            </button>
            <a href="https://buy.polar.sh/polar_cl_3udFF79S8v3TpXhKL6CWnHCGLfiHqc3urNBGs0Ae4qk" class="submit-btn"
                id="pay-polar-deposit-btn" target="_blank"
                style="background: #000; color: #fff; width: 100%; display: flex; justify-content: center; align-items: center; text-decoration: none; margin-top: 10px; border: none;">
                Pay $4.99 with Polar.sh
            </a>
            <button class="submit-btn" disabled
                style="background: #e5e7eb; color: #9ca3af; width: 100%; display: flex; justify-content: center; align-items: center; text-decoration: none; margin-top: 10px; cursor: not-allowed; border: none;">
                Pay $4.99 with PayPal (Unavailable)
            </button>
            <p style="text-align: center; margin-top: 1rem; font-size: 0.75rem; color: var(--text-secondary);">
                Secure payment via Stripe or Polar.sh ‚Ä¢ 100% Satisfaction Guarantee
            </p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-top">
                <h3 class="footer-logo">Amz AI Agent</h3>
                <p class="footer-tagline">AI Amazon Competitor Review Analysis Platform</p>
            </div>

            <div class="footer-columns">
                <div class="footer-col">
                    <h4>Product</h4>
                    <a href="create.html">Competitor Analysis</a>
                    <a href="discovery.html">Product Discovery</a>
                    <a href="pricing.html">Pricing</a>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <a href="blog.html">Blog</a>
                    <a href="cases.html">Case Studies</a>
                    <a href="faq.html">FAQ</a>
                </div>
                <div class="footer-col">
                    <h4>Company</h4>
                    <a href="about.html">About Us</a>
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="terms.html">Terms of Service</a>
                </div>
            </div>

            <div class="footer-bottom">
                <p class="footer-copyright">¬© 2025 Amz AI Agent. All rights reserved.</p>
                <a href="contact.html" class="footer-contact">Contact Us</a>
            </div>
        </div>
    </footer>
    <script src="script_v2.js"></script>
    <script src="data/amazon_categories.js"></script>
    <script>
        // Product Discovery specific form handling
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('discovery-form');
            const modal = document.getElementById('modal');
            const modalClose = document.getElementById('modal-close');
            const modalForm = document.getElementById('modal-form');

            // Category cascade elements
            const level1 = document.getElementById('category-level-1');
            const level2 = document.getElementById('category-level-2');
            const level3 = document.getElementById('category-level-3');

            // Store form data
            let discoveryData = {};
            let isProMode = false;

            // Elements
            const promptTextarea = document.getElementById('default-prompt');
            const promptBadge = document.getElementById('prompt-mode-badge');
            const focusCards = document.querySelectorAll('.focus-card');
            const paymentModal = document.getElementById('payment-modal');
            const paymentModalClose = document.getElementById('payment-modal-close');

            // Show payment modal function
            function showPaymentModal() {
                paymentModal.style.display = 'flex';
            }

            // Payment modal close
            if (paymentModalClose) {
                paymentModalClose.addEventListener('click', function () {
                    paymentModal.style.display = 'none';
                });
            }

            // Close payment modal on overlay click
            if (paymentModal) {
                paymentModal.addEventListener('click', function (e) {
                    if (e.target === paymentModal) {
                        paymentModal.style.display = 'none';
                    }
                });
            }

            // Upgrade links trigger payment modal
            const upgradeFocusLink = document.getElementById('upgrade-focus-link');
            const upgradePromptLink = document.getElementById('upgrade-prompt-link');

            if (upgradeFocusLink) {
                upgradeFocusLink.addEventListener('click', function (e) {
                    e.preventDefault();
                    showPaymentModal();
                });
            }

            if (upgradePromptLink) {
                upgradePromptLink.addEventListener('click', function (e) {
                    e.preventDefault();
                    showPaymentModal();
                });
            }

            // Ad vanced Options Pro unlock overlay
            const proUnlockOverlay = document.getElementById('pro-unlock-overlay');
            if (proUnlockOverlay) {
                proUnlockOverlay.addEventListener('click', function (e) {
                    e.preventDefault();
                    showPaymentModal();
                });
            }

            // Focus card click handlers - locked cards show payment modal
            focusCards.forEach(card => {
                card.addEventListener('click', function () {
                    if (this.classList.contains('locked')) {
                        showPaymentModal();
                        return;
                    }

                    // Pro mode: toggle selection (only works after payment)
                    if (isProMode) {
                        if (this.classList.contains('active')) {
                            const activeCards = document.querySelectorAll('.focus-card.active');
                            if (activeCards.length > 1) {
                                this.classList.remove('active');
                                this.style.border = '2px solid var(--border-color)';
                                this.style.background = 'var(--bg-secondary)';
                            }
                        } else {
                            this.classList.add('active');
                            this.style.border = '2px solid var(--primary-color)';
                            this.style.background = 'linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(37, 99, 235, 0.05))';
                        }
                    }
                });
            });

            // Payment success handler (simulated for Stripe)
            const payDepositBtn = document.getElementById('pay-deposit-btn');
            if (payDepositBtn) {
                payDepositBtn.addEventListener('click', function () {
                    const proEmail = document.getElementById('pro-email-input').value.trim();
                    if (!proEmail) {
                        alert('Please enter your email address');
                        return;
                    }

                    // Simulate payment success
                    unlockProFeatures();
                });
            }

            // Polar Payment Handler
            const payPolarBtn = document.getElementById('pay-polar-deposit-btn');
            if (payPolarBtn) {
                payPolarBtn.addEventListener('click', function (e) {
                    const proEmail = document.getElementById('pro-email-input').value.trim();
                    if (!proEmail) {
                        e.preventDefault();
                        alert('Please enter your email address');
                        return;
                    }

                    // In a real scenario, we would redirect. 
                    // For this sandbox/demo, we'll also unlock features to show the effect.
                    unlockProFeatures();

                    // Optional: redirect to Polar after a short delay if real payment is intended
                    // setTimeout(() => { window.location.href = this.href; }, 1000);
                });
            }

            function unlockProFeatures() {
                alert('Success! Pro features are now unlocked (Sandbox mode).');
                paymentModal.style.display = 'none';

                // Unlock Pro mode
                isProMode = true;

                // Make prompt editable
                promptTextarea.removeAttribute('readonly');
                promptTextarea.style.opacity = '1';
                promptTextarea.style.cursor = 'text';
                promptTextarea.style.background = 'var(--bg-primary)';
                promptTextarea.style.border = '2px solid var(--primary-color)';
                promptBadge.textContent = 'Pro: Editable';
                promptBadge.style.background = 'linear-gradient(135deg, #4f46e5, #2563eb)';
                promptBadge.style.color = 'white';

                // Unlock all focus cards
                focusCards.forEach(card => {
                    card.classList.remove('locked');
                    card.style.opacity = '1';
                    card.style.cursor = 'pointer';
                    const lockBadge = card.querySelector('.lock-badge');
                    if (lockBadge) lockBadge.style.display = 'none';
                });

                // Update helper text
                const focusHelper = document.getElementById('focus-helper');
                if (focusHelper) {
                    focusHelper.innerHTML = '‚úÖ Pro Mode Active! Click cards to toggle selection.';
                }

                // Unlock advanced options
                const proOverlay = document.getElementById('pro-unlock-overlay');
                if (proOverlay) proOverlay.style.display = 'none';

                document.querySelectorAll('.pro-feature').forEach(el => {
                    el.disabled = false;
                });
            }


            // Initialize category dropdowns
            function initCategories() {
                if (typeof amazonCategories === 'undefined') {
                    console.error('Amazon categories data not loaded');
                    return;
                }

                // Populate Level 1 (Main Categories)
                Object.keys(amazonCategories).forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    level1.appendChild(option);
                });
            }

            // Level 1 change handler
            level1.addEventListener('change', function () {
                const selectedCat = this.value;

                // Reset level 2 and 3
                level2.innerHTML = '<option value="">-- Select Sub-Category --</option>';
                level3.innerHTML = '<option value="">-- Select Product Type --</option>';
                level2.disabled = true;
                level3.disabled = true;

                if (selectedCat && amazonCategories[selectedCat]) {
                    const subCategories = Object.keys(amazonCategories[selectedCat]);
                    subCategories.forEach(subCat => {
                        const option = document.createElement('option');
                        option.value = subCat;
                        option.textContent = subCat;
                        level2.appendChild(option);
                    });
                    level2.disabled = false;
                }
            });

            // Level 2 change handler
            level2.addEventListener('change', function () {
                const mainCat = level1.value;
                const subCat = this.value;

                // Reset level 3
                level3.innerHTML = '<option value="">-- Select Product Type --</option>';
                level3.disabled = true;

                if (mainCat && subCat && amazonCategories[mainCat] && amazonCategories[mainCat][subCat]) {
                    const productTypes = amazonCategories[mainCat][subCat];
                    productTypes.forEach(prodType => {
                        const option = document.createElement('option');
                        option.value = prodType;
                        option.textContent = prodType;
                        level3.appendChild(option);
                    });
                    level3.disabled = false;
                }
            });

            // Initialize on load
            initCategories();

            // Form submit handler
            form.addEventListener('submit', function (e) {
                e.preventDefault();

                const mainCategory = level1.value;
                const subCategory = level2.value;
                const productType = level3.value;
                const keywords = document.getElementById('product-keywords').value.trim();
                const asins = document.getElementById('product-asins').value.trim();
                const marketplace = document.getElementById('marketplace').value;
                const defaultPrompt = document.getElementById('default-prompt').value;

                // Validate required fields
                if (!mainCategory) {
                    alert('Please select a main category');
                    return;
                }

                if (!keywords) {
                    alert('Please enter product keywords');
                    return;
                }

                // Build category path
                let categoryPath = mainCategory;
                if (subCategory) categoryPath += ' > ' + subCategory;
                if (productType) categoryPath += ' > ' + productType;

                // ASINs are optional - parse if provided
                const asinList = asins ? asins.split('\n').map(a => a.trim()).filter(a => a.length > 0) : [];

                // Capture selected analysis focus areas
                let focusAreas = [];
                document.querySelectorAll('.focus-card.active').forEach(card => {
                    focusAreas.push(card.dataset.value);
                });

                // Fallback if none selected (should not happen due to default)
                if (focusAreas.length === 0) focusAreas = ['market-entry'];

                // Store data
                discoveryData = {
                    type: 'discovery',
                    category: categoryPath,
                    category_main: mainCategory,
                    category_sub: subCategory,
                    category_product: productType,
                    keywords: keywords,
                    asins: asinList,
                    marketplace: marketplace,
                    analysis_focus: focusAreas,
                    prompt: defaultPrompt,
                    is_pro: isProMode
                };

                // Update Modal UI based on Pro status
                const modalTitle = document.querySelector('#submission-modal h2');
                const modalDesc = document.querySelector('#submission-modal .modal-desc');
                const upsellLink = document.getElementById('switch-to-pro-link');
                const submitBtn = document.getElementById('confirm-submission-btn');

                if (isProMode) {
                    if (modalTitle) modalTitle.textContent = "Start Premium Discovery";
                    if (modalDesc) modalDesc.textContent = "Please confirm your email to receive the comprehensive Pro analysis report.";
                    if (upsellLink) upsellLink.parentElement.parentElement.style.display = 'none'; // Hide upsell container
                    if (submitBtn) submitBtn.textContent = "Confirm & Start Pro Discovery";
                } else {
                    if (modalTitle) modalTitle.textContent = "Your Free Analysis Report";
                    if (modalDesc) modalDesc.textContent = "Please complete the info below. Your free report will be sent to your email.";
                    if (upsellLink) upsellLink.parentElement.parentElement.style.display = 'block';
                    if (submitBtn) submitBtn.textContent = "Confirm & Start Free Discovery";
                }

                // Show modal
                modal.style.display = 'flex';
            });

            modalClose.addEventListener('click', function () {
                modal.style.display = 'none';
            });

            modal.addEventListener('click', function (e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            modalForm.addEventListener('submit', function (e) {
                e.preventDefault();

                const userName = document.getElementById('user-name').value.trim();
                const userEmail = document.getElementById('user-email').value.trim();
                const userIndustry = document.getElementById('user-industry').value.trim();

                // Combine all data
                const finalPayload = {
                    ...discoveryData,
                    user: {
                        name: userName,
                        email: userEmail,
                        industry: userIndustry
                    },
                    submittedAt: new Date().toISOString()
                };

                console.log('Final Discovery Payload:', finalPayload);

                // Show loading state
                const submitBtn = document.getElementById('confirm-submission-btn');
                const originalBtnText = submitBtn.textContent;
                submitBtn.textContent = "Processing...";
                submitBtn.disabled = true;

                // Prepare API Payload
                const apiPayload = {
                    category: finalPayload.category,
                    category_main: finalPayload.category_main, // Pass details if backend supports
                    category_sub: finalPayload.category_sub,
                    category_product: finalPayload.category_product,
                    keywords: finalPayload.keywords,
                    marketplace: finalPayload.marketplace,
                    prompt: finalPayload.prompt,
                    analysis_focus: finalPayload.analysis_focus || [],
                    // Map is_pro boolean to user_tier enum ('free' or 'pro')
                    user_tier: (finalPayload.is_pro) ? 'pro' : 'free',
                    // User info path might differ in backend model, sending flat
                    user_email: finalPayload.user.email,
                    user_name: finalPayload.user.name,
                    user_industry: finalPayload.user.industry
                };

                console.log('Sending to Backend:', apiPayload);

                // Call Backend API
                fetch('/api/discovery/start-task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(apiPayload)
                })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(err => { throw new Error(err.detail || 'Server Error'); });
                        }
                        return response.json();
                    })
                    .then(data => {
                        modal.style.display = 'none';

                        if (data.report_id || data.task_id) {
                            const taskId = data.report_id || data.task_id;
                            // Redirect to Processing Page with Terminal
                            window.location.href = `processing.html?taskId=${taskId}&email=${encodeURIComponent(userEmail)}`;
                        } else if (data.success) {
                            // Fallback if no task ID returned
                            alert('Success! Request received.');
                            form.reset();
                            modalForm.reset();
                        } else {
                            alert('Error: ' + (data.message || 'Unknown error'));
                        }
                    })
                    .catch(error => {
                        console.error('API Error:', error);
                        alert('Submission Failed: ' + error.message + '\n\nPlease ensure the backend service is running.');
                    })
                    .finally(() => {
                        // Reset UI
                        submitBtn.textContent = originalBtnText;
                        submitBtn.disabled = false;
                    });
            });
        });
    </script>
</body>

</html>